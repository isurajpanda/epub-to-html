:root {
    --bg-color: #000000;
    --text-color: #ffffff;
    --sidebar-bg: #1a1a1a;
    --sidebar-border: #333;
    --sidebar-text: #ccc;
    --sidebar-hover-bg: #333;
    --link-color: #00ffff;
    --link-visited: #00cccc;
    /* opaque topbar so content underneath isn't visible through it */
    --topbar-bg: #1a1a1a;
    --topbar-button-hover: #444;
    --separator-color: #444;
    --sidebar-width: 320px;
    --topbar-height: 48px;
    /* The nominal maximum content width; updated in larger breakpoints. */
    --content-max: 48rem;
    /* Unified transition timing */
    --transition-duration: 0.3s;
    --transition-easing: cubic-bezier(0.25, 0.1, 0.25, 1);
}
html, body {
    margin: 0;
    padding: 0;
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: serif;
    line-height: 1.6;
}
#app-container {
    display: flex;
    height: 100vh;
    overflow: hidden;
    position: relative;
}
#sidebar-container {
    position: fixed;
    top: 0;
    left: 0; /* occupy layout slot but moved off-screen with transform */
    width: var(--sidebar-width);
    height: 100%;
    /* Sidebar should be above toolbar but below right controls */
    z-index: 1200;
    /* Use transform for smoother, GPU-accelerated animation */
    transform: translateX(calc(-100% - 2px)); /* Extra buffer to ensure complete hiding */
    transition: transform 0.26s cubic-bezier(.2,.9,.2,1);
    will-change: transform;
    box-shadow: 5px 0 15px rgba(0,0,0,0.5);
    /* Ensure no edge is visible when closed */
    overflow: hidden;
}
#content-wrapper {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    /* Content wrapper naturally starts below the fixed top bar */
    margin-top: var(--topbar-height);
    /* Keep content-wrapper free of transforms so fixed-position children
       (like the top toolbar/right-controls) remain fixed to the viewport.
       Transforms will be applied to #main-content instead. */
    transition: margin-top var(--transition-duration) var(--transition-easing);
}

/* When in fullscreen mode we hide the top toolbar and remove the margin */
.is-fullscreen #content-wrapper {
    margin-top: 0;
    height: 100vh;
}
#app-container.sidebar-open #sidebar-container {
    transform: translateX(0);
}

/* On desktop, shift the main reading area when the sidebar opens. We apply
   transforms to #main-content (not #content-wrapper) to avoid creating a
   containing block that would break position:fixed children. */
@media (min-width: 768px) {
    #app-container.sidebar-open #main-content {
        transform: translateX(calc(var(--sidebar-width) * 0.5));
    }
}
#main-content {
    overflow-y: auto;
    overflow-x: hidden;
    flex-grow: 1;
    padding: 1rem;
    box-sizing: border-box;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
    will-change: scroll-position, transform;
    /* Allow the main content to be transformed when the sidebar opens */
    transition: transform 0.26s cubic-bezier(.2,.9,.2,1);
    /* Ensure anchor scrolling accounts for the fixed toolbar */
    scroll-padding-top: var(--topbar-height);
    /* Use CSS Grid for perfect centering */
    display: grid;
    grid-template-columns: 1fr;
    justify-items: center;
    align-content: start;
    position: relative;
    z-index: 1;
}

/* Mobile adjustments */
@media (max-width: 768px) {
    #main-content {
        padding: 0.5rem;
    }
}

@media (max-width: 480px) {
    #main-content {
        padding: 0.25rem;
    }
}

.toc-view {
    overflow-y: auto;
}

/* Scrollbar Styles */

/* Prominent but sleek mobile scrollbar */
@media (max-width: 768px) {
    #main-content::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    #main-content::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
    }
    
    #main-content::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: background-color 0.2s ease, border-color 0.2s ease;
    }
    
    #main-content::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.45);
        border-color: rgba(255, 255, 255, 0.2);
    }
    
    #main-content::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.5);
    }
    
    #main-content::-webkit-scrollbar-corner {
        background: transparent;
    }
    
    /* Fallback for browsers that don't support webkit scrollbar */
    #main-content {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.05);
    }
}

/* Style scrollbar for desktop */
@media (min-width: 769px) {
    #main-content::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    #main-content::-webkit-scrollbar-track {
        background: transparent;
    }

    #main-content::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
    }

    #main-content::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.4);
    }

    #main-content::-webkit-scrollbar-corner {
        background: transparent;
    }
}

/* TOC Scrollbar Styles (visible on all screen sizes) */
.toc-view::-webkit-scrollbar {
    width: 4px;
    height: 4px;
}

.toc-view::-webkit-scrollbar-track {
    background: transparent;
}

.toc-view::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
}

.toc-view::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.4);
}

.toc-view::-webkit-scrollbar-corner {
    background: transparent;
}
.content-body {
    /* Responsive width that scales with viewport and font size */
    width: min(48rem, 90vw);
    max-width: 48rem;
    padding: 1.5rem;
    font-size: clamp(1rem, 1.2rem, 1.5rem);
    /* Ensure content doesn't overflow horizontally on mobile */
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
    /* Smooth transitions for font size and layout changes */
    transition: width 0.3s cubic-bezier(0.25, 0.1, 0.25, 1),
                padding 0.3s cubic-bezier(0.25, 0.1, 0.25, 1),
                font-size 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
    /* Ensure proper centering */
    justify-self: center;
    box-sizing: border-box;
}
.content-body a { color: var(--link-color); }
.content-body a * { color: var(--link-color); }
.content-body a:visited { color: var(--link-visited); }
.content-body a:visited * { color: var(--link-visited); }
hr.chapter-separator { margin: 3em 0; border: none; border-top: 1px solid var(--separator-color); }
img { max-width: 100%; height: auto; display: block; margin: 0 auto 1em auto; }

/* Responsive padding adjustments for different screen sizes */
@media (max-width: 480px) {
    #main-content {
        padding: 0.5rem;
    }
    
    /* Adjust top bar positioning on mobile to prevent image cropping */
    .top-toolbar {
        top: 25px;
    }
    
    .top-toolbar .top-left-controls {
        top: 29px; /* 25px + 4px offset */
    }
    
    .top-toolbar .top-right-controls {
        top: 29px; /* 25px + 4px offset */
    }
    
    /* Adjust content wrapper margin to account for lower top bar */
    #content-wrapper {
        margin-top: 48px;
    }
    
    /* Adjust scroll padding to match the lower top bar position */
    #main-content {
        scroll-padding-top: 50px;
    }
    
    /* Remove the extra padding from first image since top bar is now positioned correctly */
    .content-body img.cover:first-of-type {
        padding-top: 0;
    }
}

@media (min-width: 481px) and (max-width: 768px) {
    #main-content {
        padding: 0.75rem;
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    #main-content {
        padding: 1rem;
    }
}

@media (min-width: 1025px) {
    #main-content {
        padding: 1.5rem;
    }
}

/* Ensure all content elements don't overflow horizontally */
.content-body * {
    max-width: 100%;
    box-sizing: border-box;
}

/* Prevent long words from breaking layout */
.content-body p, .content-body div, .content-body span {
    word-wrap: break-word;
    overflow-wrap: break-word;
}

/* Mobile content positioning and font sizing */
@media (max-width: 768px) {
    .content-body {
        width: min(48rem, 95vw);
        padding: 0.75rem;
    }
    
    /* Font size responsive widths */
    .content-body.text-lg { width: min(42rem, 93vw); }
    .content-body.text-xl { width: min(38rem, 91vw); }
    .content-body.text-2xl { width: min(34rem, 89vw); }
    .content-body.text-3xl { width: min(30rem, 87vw); }
    .content-body.text-4xl { width: min(26rem, 85vw); }
    .content-body.text-5xl { width: min(22rem, 83vw); }
}

@media (max-width: 480px) {
    .content-body {
        width: min(48rem, 94vw);
        padding: 0.5rem;
    }
    
    .content-body.text-lg { width: min(38rem, 92vw); }
    .content-body.text-xl { width: min(34rem, 90vw); }
    .content-body.text-2xl { width: min(30rem, 88vw); }
    .content-body.text-3xl { width: min(26rem, 86vw); }
    .content-body.text-4xl { width: min(22rem, 84vw); }
    .content-body.text-5xl { width: min(18rem, 82vw); }
}

@media (min-width: 1200px) {
    /*
      Make desktop content match an approximate "63% zoom" feel by using
      a viewport-relative width (63vw) while constraining it with sensible
      minimum and maximum values to avoid too-narrow or too-wide lines.
      clamp(min, preferred, max) ensures the content remains readable.
    */
    .content-body {
        max-width: clamp(48rem, 63vw, 72rem);
        margin: 0 auto;
    }
    /* Update the content max variable to reflect the larger desktop sizing
       so any responsive calculations (like when the sidebar opens) use the
       correct target width. */
    :root { --content-max: clamp(48rem, 63vw, 72rem); }
    /* Add extra left/right padding on desktop for breathing room */
    #main-content {
        padding-left: 4rem;
        padding-right: 4rem;
    }
}

@media (min-width: 1600px) {
    /* For ultra-wide screens, increase side padding while clamp still caps width */
    #main-content {
        padding-left: 6rem;
        padding-right: 6rem;
    }
}
/* UI Components from toc_and_topbar.js */
.toc-sidebar {
    width: 100%; height: 100%; background: var(--sidebar-bg);
    box-shadow: 0 0 0 1px var(--sidebar-border); display: flex; flex-direction: column;
    font-family: sans-serif;
}
.toc-sidebar-header {
    display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid var(--sidebar-border);
}
.toc-sidebar-header img { width: 80px; height: auto; border-radius: 3px; margin-right: 0.75rem; object-fit: cover; }
.toc-sidebar-header h1 { font-size: 1.1em; margin: 0; color: var(--text-color); font-family: sans-serif; }
.toc-sidebar-header p { font-size: small; color: var(--sidebar-text); margin-top: 0.2rem; font-family: sans-serif; }
.toc-view { padding: .5rem; overflow-y: auto; flex-grow: 1; }
.toc-view ul { list-style: none; padding: 0; margin: 0; }
.toc-view a, .toc-view span {
    display: block; padding: 8px 12px; text-decoration: none; color: var(--sidebar-text);
    border-radius: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    font-family: sans-serif;
}
.toc-view a:hover { background: var(--sidebar-hover-bg); }
.toc-view ul ul { padding-left: 1rem; }
.top-toolbar {
    /* Fixed toolbar so its right-side controls remain visible while the
       content-wrapper and main content can be translated underneath. */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    display: flex; justify-content: space-between; align-items: center; height: var(--topbar-height);
    padding: 0 10px; background: var(--topbar-bg); backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--sidebar-border); flex-shrink: 0;
    transition: opacity var(--transition-duration) var(--transition-easing), 
                visibility var(--transition-duration) var(--transition-easing), 
                transform var(--transition-duration) var(--transition-easing);
    will-change: opacity, transform;
    transform: translateZ(0);
    z-index: 1100; /* Base toolbar layer */
}
/* The toolbar is fixed to the top and also acts as a positioned container
    for its absolutely-positioned inner controls. */
/* .top-toolbar remains position: fixed (declared above) so we do not
    re-declare position here which would break the fixed behavior. */

/* Simplified positioning - both control groups are fixed to viewport */
/* Loading animation for TOC button */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-spinner {
    animation: spin 1s linear infinite;
}

.button-loading {
    pointer-events: none;
    opacity: 0.7;
}

.top-toolbar .top-left-controls {
    position: fixed;
    left: 12px;
    top: 4px; /* Static positioning: (48px - 40px) / 2 = 4px */
    display: flex;
    gap: 6px;
    z-index: 1300; /* Above sidebar, below right controls */
    transition: transform 0.26s cubic-bezier(.2,.9,.2,1);
    transform: translateX(0);
}

.top-toolbar .top-right-controls {
    position: fixed;
    right: 12px;
    top: 4px; /* Static positioning: (48px - 40px) / 2 = 4px */
    display: flex;
    gap: 6px;
    z-index: 1400; /* Highest z-index to stay above sidebar */
}
.top-toolbar.fullscreen-hidden {
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;
    transition: opacity var(--transition-duration) var(--transition-easing), 
                visibility var(--transition-duration) var(--transition-easing);
}
.top-toolbar div { display: flex; align-items: center; }
.top-toolbar button {
    margin: 0 2px; padding: 10px; border: none; background: none; border-radius: 6px;
    cursor: pointer; color: var(--text-color); transition: background 0.2s;
    display: flex; align-items: center; justify-content: center;
}
.top-toolbar button:hover { background: var(--topbar-button-hover); }
.top-toolbar svg { width: 22px; height: 22px; }
/* Responsive Typography */
.text-xs { font-size: clamp(0.6rem, 0.75rem, 0.9rem); }
.text-sm { font-size: clamp(0.7rem, 0.875rem, 1.05rem); }
.text-base { font-size: clamp(0.8rem, 1rem, 1.2rem); }
.text-lg { font-size: clamp(0.9rem, 1.125rem, 1.35rem); }
.text-xl { font-size: clamp(1rem, 1.25rem, 1.5rem); }
.text-2xl { font-size: clamp(1.2rem, 1.5rem, 1.8rem); }
.text-3xl { font-size: clamp(1.5rem, 1.875rem, 2.25rem); }
.text-4xl { font-size: clamp(1.8rem, 2.25rem, 2.7rem); }
.text-5xl { font-size: clamp(2.4rem, 3rem, 3.6rem); }


/* Responsive base font size */
@media (min-width: 768px) {
    /* Restore the previous content behavior: translate the content by half
       the sidebar width so the central reading area stays roughly centered.
       We'll additionally nudge the left controls so they end up fully
       visible (they'll move the remaining half-width). */
    #app-container.sidebar-open #main-content {
        transform: translateX(calc(var(--sidebar-width) * 0.5));
    }

    /* Position the left toolbar controls so they start where the TOC ends.
       Move them by the full sidebar width so they align to the right edge of
       the open sidebar (plus the left:12px offset defined earlier). */
    #app-container.sidebar-open .top-toolbar .top-left-controls {
        transform: translateX(var(--sidebar-width));
    }

    /* Prevent the main reading content from being cropped when the sidebar
       opens by constraining the content width to the remaining viewport
       space (viewport width minus sidebar). We keep some horizontal
       breathing room (4rem) so the layout doesn't feel tight. */
    #app-container.sidebar-open .content-body {
        /* Only shrink the content when the available viewport width is
           smaller than the nominal content width. Use min() so we pick the
           smaller of the two â€” the content will only shrink when necessary. */
        max-width: min(var(--content-max), calc(100vw - var(--sidebar-width) - 4rem));
        transition: max-width 220ms cubic-bezier(.2,.9,.2,1);
    }
}
@media (min-width: 769px) and (max-width: 1200px) {
    html {
        font-size: 16px;
    }
}

/* Image Popup Modal (Mobile Only) */
.image-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    z-index: 2000;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 10px;
    box-sizing: border-box;
    cursor: pointer;
}

.image-modal.active {
    display: flex;
}

.image-modal-content {
    position: relative;
    max-width: 90%;
    max-height: calc(90% - 60px); /* Leave space for close button */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 15px;
    cursor: default;
}

.image-modal img {
    max-width: 100%;
    max-height: calc(100% - 60px); /* Leave space for close button */
    object-fit: contain;
    touch-action: pinch-zoom; /* Enable pinch-to-zoom */
    user-select: none;
    -webkit-user-drag: none;
}

.image-modal-close {
    position: fixed !important;
    bottom: 20px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    background: rgba(0, 0, 0, 0.8) !important;
    border: 1px solid rgba(255, 255, 255, 0.4) !important;
    color: white !important;
    padding: 10px 20px !important;
    border-radius: 25px !important;
    cursor: pointer !important;
    font-size: 16px !important;
    font-weight: bold !important;
    transition: background-color 0.2s ease !important;
    backdrop-filter: blur(8px) !important;
    z-index: 3000 !important;
    pointer-events: auto !important;
    display: block !important;
}

.image-modal-close:hover {
    background: rgba(0, 0, 0, 0.9) !important;
    border-color: rgba(255, 255, 255, 0.6) !important;
}

.image-modal-close:active {
    background: rgba(0, 0, 0, 1) !important;
}

/* Make images clickable on mobile only */
@media (max-width: 768px) {
    .content-body img {
        cursor: pointer;
        transition: opacity 0.2s ease;
    }
    
    .content-body img:hover {
        opacity: 0.9;
    }
}

/* Hide image modal on desktop */
@media (min-width: 769px) {
    .image-modal {
        display: none !important;
    }
    
    .content-body img {
        cursor: default;
    }
}

/* Invisible overlay to block content interaction when TOC is open (Mobile Only) */
@media (max-width: 768px) {
    .toc-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: transparent;
        display: none;
        z-index: 1000; /* Above content, below TOC sidebar (z-index: 1200) */
        pointer-events: none; /* Don't block clicks by default */
    }

    .toc-overlay.active {
        display: block;
        pointer-events: auto; /* Block all clicks when active */
    }
}

/* Hide overlay on desktop */
@media (min-width: 769px) {
    .toc-overlay {
        display: none !important;
        pointer-events: none !important;
    }
}
