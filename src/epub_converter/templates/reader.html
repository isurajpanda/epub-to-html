<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="public, max-age=31536000">
    <meta name="robots" content="index, follow">
    <title>{{ title }}</title>

    <meta name="description"
        content="{% if metadata.get('description') and metadata.get('description') != 'None' %}{{ metadata.get('description') }}{% else %}Read {{ title }} online. A digital book reader with optimized viewing experience.{% endif %}">
    <meta name="author" content="{{ metadata.get('author', 'Unknown') }}">
    <meta name="keywords"
        content="{{ title }}, epub, digital book, reader{% if metadata.get('subject') %}, {{ metadata.get('subject')|join(', ') }}{% endif %}">
    {% if metadata.get('publisher') %}
    <meta name="publisher" content="{{ metadata.get('publisher') }}">{% endif %}
    {% if metadata.get('date') %}
    <meta name="date" content="{{ metadata.get('date') }}">{% endif %}
    {% if metadata.get('language') %}
    <meta name="language" content="{{ metadata.get('language') }}">{% endif %}
    <meta property="og:title" content="{{ title }}">
    <meta property="og:type" content="book">
    {% if metadata.get('author') %}
    <meta property="og:author" content="{{ metadata.get('author') }}">{% endif %}
    <meta property="og:description" content="{{ metadata.get('description', 'Read ' + title + ' online.') }}">

    <!-- Preload critical resources for better performance -->
    <link rel="preload" href="/static/style.css" as="style" crossorigin="anonymous" fetchpriority="high">
    {% if metadata.get('cover_image_url') %}
    <link rel="preload" href="{{ metadata.get('cover_image_url') }}" as="image" fetchpriority="high">
    {% endif %}

    <link rel="stylesheet" href="/static/style.css" crossorigin="anonymous">
    <script src="/static/script.js" crossorigin="anonymous" defer></script>
    {% if custom_css %}
    <style>
        {
                {
                custom_css
            }
        }
    </style>
    {% endif %}

    <script id="app-data" type="application/json">
        {{ metadata_json }}
    </script>
</head>

<body class="">
    <h1 id="series-title" class="series-title">{{ title }}</h1>
    <div id="app-container">
        <aside id="sidebar-container">
            <div class="toc-sidebar">
                <div class="toc-sidebar-header">
                    {% if metadata.get('cover_image_url') %}
                    <img id="book-cover" src="{{ metadata.get('cover_image_url') }}" alt="Book cover" loading="lazy">
                    {% else %}
                    <img id="book-cover" src="" alt="Book cover" style="display: none;">
                    {% endif %}
                    <div class="book-info">
                        <h1 id="book-title" style="display: none;"></h1>
                        <p id="book-author" style="display: none;"></p>
                    </div>
                </div>
                <div class="toc-view" id="toc-list">
                </div>
            </div>
        </aside>
        <aside id="settings-sidebar-container">
            <div class="settings-sidebar">
                <div class="settings-header">
                    <h2>Reader Settings</h2>
                    <button id="settings-close" aria-label="Close settings">×</button>
                </div>
                <div class="settings-content">
                    <!-- Font Size Section -->
                    <div class="settings-section">
                        <div class="font-size-control">
                            <div id="font-size-preview" class="font-size-preview">Lorem ipsum</div>

                            <!-- Bionic Reading Button -->
                            <div style="margin-top: 1rem; margin-bottom: 1rem;">
                                <button id="bionic-reading-toggle" class="font-option" data-no-bionic="true"
                                    style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                    <span>Bionic Reading</span>
                                </button>
                            </div>

                            <h3>Font Size</h3>
                            <div class="slider-container">
                                <span class="size-label small">A</span>
                                <input type="range" id="font-size-slider" min="12" max="40" step="2" value="18"
                                    aria-label="Font size">
                                <span class="size-label large">A</span>
                            </div>
                        </div>
                    </div>

                    <!-- Font Family Section -->
                    <div class="settings-section">
                        <h3>Font Family</h3>
                        <div class="font-family-grid">
                            <button class="font-option active" data-font="original"
                                style="font-family: serif;">Original</button>
                            <button class="font-option" data-font="sans-serif"
                                style="font-family: sans-serif;">Sans</button>
                            <button class="font-option" data-font="arial"
                                style="font-family: Arial, sans-serif;">Arial</button>
                            <button class="font-option" data-font="verdana"
                                style="font-family: Verdana, sans-serif;">Verdana</button>
                            <button class="font-option" data-font="georgia"
                                style="font-family: Georgia, serif;">Georgia</button>
                            <button class="font-option" data-font="comic-sans"
                                style="font-family: 'Comic Sans MS', cursive;">Comic</button>
                        </div>


                        <div class="setting-group">
                            <div class="theme-header">
                                <h3>Theme</h3>
                                <div class="mode-toggle">
                                    <span class="mode-label">Light</span>
                                    <label class="switch">
                                        <input type="checkbox" id="theme-mode-toggle" aria-label="Toggle Dark Mode">
                                        <span class="slider round"></span>
                                    </label>
                                    <span class="mode-label">Dark</span>
                                </div>
                            </div>
                            <div class="theme-options">
                                <button class="theme-option active" data-theme="classic" aria-label="Classic theme">
                                    <div class="theme-preview classic"></div>
                                    <span>Classic</span>
                                </button>
                                <button class="theme-option" data-theme="vintage" aria-label="Vintage theme">
                                    <div class="theme-preview vintage"></div>
                                    <span>Vintage</span>
                                </button>
                                <button class="theme-option" data-theme="lipstick" aria-label="Lipstick theme">
                                    <div class="theme-preview lipstick"></div>
                                    <span>Lipstick</span>
                                </button>
                                <button class="theme-option" data-theme="ocean" aria-label="Ocean theme">
                                    <div class="theme-preview ocean"></div>
                                    <span>Ocean</span>
                                </button>
                                <button class="theme-option" data-theme="cyber" aria-label="Cyber theme">
                                    <div class="theme-preview cyber"></div>
                                    <span>Cyber</span>
                                </button>
                                <button class="theme-option" data-theme="nature" aria-label="Nature theme">
                                    <div class="theme-preview nature"></div>
                                    <span>Nature</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
        </aside>
        <div id="content-wrapper">
            <header id="topbar-container">
                <div class="top-toolbar">
                    <div class="top-left-controls">
                        <button type="button" title="Loading..." aria-label="Loading..." id="sidebar-toggle"
                            class="button-loading">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-list loading-spinner" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                            </svg>
                        </button>
                        <button type="button" title="Previous Chapter" aria-label="Previous Chapter" id="prev-chapter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-left-short" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5" />
                            </svg>
                        </button>
                        <button type="button" title="Next Chapter" aria-label="Next Chapter" id="next-chapter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-right-short" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8" />
                            </svg>
                        </button>
                    </div>
                    <div class="top-right-controls">
                        <button id="settings-toggle" class="icon-button" aria-label="Settings">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-sliders" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1z" />
                            </svg>
                        </button>
                        <button type="button" title="Download EPUB" aria-label="Download EPUB" id="download-epub">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-download" viewBox="0 0 16 16">
                                <path
                                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5" />
                                <path
                                    d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z" />
                            </svg>
                        </button>
                        <button type="button" title="Toggle fullscreen" aria-label="Toggle fullscreen"
                            id="fullscreen-toggle">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-fullscreen" viewBox="0 0 16 16">
                                <path
                                    d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5M.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>
            <main id="main-content" tabindex="0">
                <div class="content-body text-base">
                    {{ body_content }}
                </div>
            </main>
        </div>
    </div>

    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <div id="image-modal" class="image-modal">
        <div class="image-modal-content">
            <img id="modal-image" src="" alt="Image">
            <button id="modal-close" class="image-modal-close" title="Close">×</button>
        </div>
    </div>
</body>

</html>