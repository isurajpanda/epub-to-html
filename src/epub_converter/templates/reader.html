<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="public, max-age=31536000">
    <title>{{ title }}</title>

    <meta name="description"
        content="{% if metadata.get('description') and metadata.get('description') != 'None' %}{{ metadata.get('description') }}{% else %}Read {{ title }} online. A digital book reader with optimized viewing experience.{% endif %}">
    <meta name="author" content="{{ metadata.get('author', 'Unknown') }}">
    <meta name="keywords"
        content="{{ title }}, epub, digital book, reader{% if metadata.get('subject') %}, {{ metadata.get('subject')|join(', ') }}{% endif %}">
    {% if metadata.get('publisher') %}
    <meta name="publisher" content="{{ metadata.get('publisher') }}">{% endif %}
    {% if metadata.get('date') %}
    <meta name="date" content="{{ metadata.get('date') }}">{% endif %}
    {% if metadata.get('language') %}
    <meta name="language" content="{{ metadata.get('language') }}">{% endif %}
    <meta property="og:title" content="{{ title }}">
    <meta property="og:type" content="book">
    {% if metadata.get('author') %}
    <meta property="og:author" content="{{ metadata.get('author') }}">{% endif %}
    <meta property="og:description" content="{{ metadata.get('description', 'Read ' + title + ' online.') }}">

    <!-- Preload cover image for better LCP performance -->
    {% if metadata.get('cover_image_url') %}
    <link rel="preload" href="{{ metadata.get('cover_image_url') }}" as="image" fetchpriority="high">
    {% endif %}

    <link rel="stylesheet" href="/static/style.css" crossorigin="anonymous">
    <script src="/static/script.js" crossorigin="anonymous" defer></script>
    {% if custom_css %}
    <style>
        {
                {
                custom_css
            }
        }
    </style>
    {% endif %}

    <script id="app-data" type="application/json">
        {{ metadata_json }}
    </script>
</head>

<body class="">
    <h1 id="series-title" class="series-title">{{ title }}</h1>
    <div id="app-container">
        <aside id="sidebar-container">
            <div class="toc-sidebar">
                <div class="toc-sidebar-header">
                    {% if metadata.get('cover_image_url') %}
                    <img id="book-cover" src="{{ metadata.get('cover_image_url') }}" alt="Book cover"
                        fetchpriority="high" loading="eager">
                    {% else %}
                    <img id="book-cover" src="" alt="Book cover" style="display: none;">
                    {% endif %}
                    <div class="book-info">
                        <h1 id="book-title" style="display: none;"></h1>
                        <p id="book-author" style="display: none;"></p>
                    </div>
                </div>
                <div class="toc-view" id="toc-list">
                </div>
            </div>
        </aside>
        <div id="content-wrapper">
            <header id="topbar-container">
                <div class="top-toolbar">
                    <div class="top-left-controls">
                        <button type="button" title="Loading..." aria-label="Loading..." id="sidebar-toggle"
                            class="button-loading">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-list loading-spinner" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5" />
                            </svg>
                        </button>
                        <button type="button" title="Previous Chapter" aria-label="Previous Chapter" id="prev-chapter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-left-short" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5" />
                            </svg>
                        </button>
                        <button type="button" title="Next Chapter" aria-label="Next Chapter" id="next-chapter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-arrow-right-short" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8" />
                            </svg>
                        </button>
                    </div>
                    <div class="top-right-controls">
                        <button type="button" title="Toggle font size" aria-label="Toggle font size"
                            id="font-size-toggle">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="currentColor">
                                <path
                                    d="M12.19 8.84a1.45 1.45 0 0 0-1.4-1h-.12a1.46 1.46 0 0 0-1.42 1L1.14 26.56a1.29 1.29 0 0 0-.14.59 1 1 0 0 0 1 1 1.12 1.12 0 0 0 1.08-.77l2.08-4.65h11l2.08 4.59a1.24 1.24 0 0 0 1.12.83 1.08 1.08 0 0 0 1.08-1.08 1.64 1.64 0 0 0-.14-.57ZM6.08 20.71l4.59-10.22 4.6 10.22Z" />
                                <path
                                    d="M32.24 14.78A6.35 6.35 0 0 0 27.6 13.2a11.36 11.36 0 0 0-4.7 1 1 1 0 0 0-.58.89 1 1 0 0 0 .94.92 1.23 1.23 0 0 0 .39-.08 8.87 8.87 0 0 1 3.72-.81c2.7 0 4.28 1.33 4.28 3.92v.5a15.29 15.29 0 0 0-4.42-.61c-3.64 0-6.14 1.61-6.14 4.64v.05c0 2.95 2.7 4.48 5.37 4.48a6.29 6.29 0 0 0 5.19-2.48v1.01a1 1 0 0 0 1 1 1 1 0 0 0 1-1.06V19a5.71 5.71 0 0 0-1.41-4.22Zm-.56 7.7c0 2.28-2.17 3.89-4.81 3.89-1.94 0-3.61-1.06-3.61-2.86v-.06c0-1.8 1.5-3 4.2-3a15.2 15.2 0 0 1 4.22.61Z" />
                            </svg>
                        </button>
                        <button type="button" title="Download EPUB" aria-label="Download EPUB" id="download-epub">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-download" viewBox="0 0 16 16">
                                <path
                                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5" />
                                <path
                                    d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z" />
                            </svg>
                        </button>
                        <button type="button" title="Toggle fullscreen" aria-label="Toggle fullscreen"
                            id="fullscreen-toggle">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                class="bi bi-fullscreen" viewBox="0 0 16 16">
                                <path
                                    d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5M.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>
            <main id="main-content" tabindex="0">
                <div class="content-body text-base">
                    {{ body_content }}
                </div>
            </main>
        </div>
    </div>

    <div id="toc-overlay" class="toc-overlay"></div>

    <div id="image-modal" class="image-modal">
        <div class="image-modal-content">
            <img id="modal-image" src="" alt="Image">
            <button id="modal-close" class="image-modal-close" title="Close">Ã—</button>
        </div>
    </div>
</body>

</html>